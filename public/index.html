<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>网易云音乐 API</title>
  <style>
      html,
      body {
          height: 100vh;
          width: 100vw;
          margin: 0;
          padding: 0;
          background: #ffffff;
          text-align: center;
          margin-top: 30px;
          overflow: hidden;
      }



      a {
          color: #42b983;
      }


      .image{
          width: 50px;
      }
      .el-table__body-wrapper::-webkit-scrollbar {
          /*width: 0;宽度为0隐藏*/
          width: 0px;
      }
      .el-table__body-wrapper::-webkit-scrollbar-thumb {
          border-radius: 2px;
          height: 50px;
          background: #eee;
      }
      .el-table__body-wrapper::-webkit-scrollbar-track {
          box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
          border-radius: 2px;
          background: rgba(0, 0, 0, 0.4);
      }

  </style>

  <!-- 引入样式 -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">

</head>

<body>
<div id="app">
  <h1>网易云音乐</h1>
  <br>
  <br>
<!--  当你看到这个页面时,这个服务已经成功跑起来了~-->
<!--  <a href="https://neteasecloudmusicapi.vercel.app">查看文档</a>-->
<!--  <h2>例子:</h2>-->

  <el-form :inline="true" class="demo-form-inline" @submit.native.prevent>
    <el-form-item label="关键词">
      <el-input v-model="keyWords" placeholder="赶快动手吧!" @keyup.enter.native="search"></el-input>
    </el-form-item>
    <el-form-item>
      <el-button @click="search">查询</el-button>
    </el-form-item>
  </el-form>

  <el-row :gutter="20">
    <el-col :span="12" :offset="6" >
      <el-table
        :data="itemList"
        border
        height="600"
        width="100%">
        <el-table-column
          label="封面"
          minWidth="150">
          <template slot-scope="scope">
            <img class="image" :src="scope.row.al.picUrl" :alt="scope.row.al.name">
          </template>
        </el-table-column>
        <el-table-column
          prop="al.name"
          label="专辑"
          minWidth="120">
        </el-table-column>
        <el-table-column
          prop="name"
          label="歌名"
          minWidth="120">
        </el-table-column>
        <el-table-column
          prop="ar"
          label="歌手"
          minWidth="120">
        </el-table-column>
        <el-table-column
          label="操作"
          minWidth="200">
          <template slot-scope="scope">
            <el-button @click="play(scope.$index)" size="small">播放</el-button>
            <el-link type="warning" :href="scope.row.url">右键另存下载</el-link>
          </template>
        </el-table-column>
      </el-table>
    </el-col>
  </el-row>

</div>
<div id="aplayer"></div>
</body>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/axios/0.20.0-0/axios.min.js"></script>
<script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<!-- 引入组件库 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
  const ap = new APlayer({
    container: document.getElementById('aplayer'),
    mutex: true,
    fixed: true,
  })
  function play(index) {
    ap.list.switch(index)
    ap.play()
  }

  const app = new Vue({
    el: "#app",
    data: {
      message: "Hello Vue!",
      visible: false,
      keyWords: "",
      itemList: []
    },
    methods: {
      search: async function() {
        const _that = this;
        ap.list.clear()
        if (!_that.keyWords) {
          const res = await axios({
            url: "/search/hot",
            method: "get"
          });
          _that.keyWords = res.data.result.hots[parseInt(Math.random() * 10)].first;
        }
        const res = await axios({
          url: "/cloudsearch",
          method: "get",
          params: {
            keywords: _that.keyWords
          }
        });
        let list = [];
        let temp = res.data.result.songs
        for (let i = 0; i < temp.length; i++) {
          if (temp[i].ar[0]) {
            temp[i].ar = temp[i].ar[0] ? (temp[i].ar[0].name + (temp[i].ar[1] ? ('/' + temp[i].ar[1].name) : '')) : '';
          }
          const res1 = await axios({
            url: "/song/url",
            method: "get",
            params: {
              id: temp[i].id
            }
          });
          if (res1.data.data[0].url) {
            temp[i].url = res1.data.data[0].url;
            ap.list.add([{
              name: temp[i].name,
              artist: temp[i].ar,
              url: temp[i].url,
              cover: temp[i].al.picUrl,
              theme: "#ebd0c2"
            }]);
            list.push(temp[i])
          }
        }
        _that.itemList = list;
        play(0);
        return true;
      }
    }
  });
</script>

</html>
